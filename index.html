<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>優香の一問一答｜メニュー</title>
  <link rel="stylesheet" href="./ui/css/base.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
</head>
<body>
  <div class="main-wrapper">
    <h1>単語クイズメニュー</h1>

    <div class="hero-subtitle">
      優香さん、今日も一歩ずつ進みましょう。
    </div> 

    <div class="card search-card">
     <label class="field-label">単語を検索</label>
     <div class="search-box-container">
     <input type="text" id="word-search" placeholder="英単語や日本語で検索..." autocomplete="off">
     <div id="search-results" class="search-results-dropdown" style="display:none;"></div>
     </div>
    </div>

    <div class="card main-action-card">
      <label for="category" class="field-label">学習するカテゴリ</label>
      <div class="custom-select">
        <select id="category">
          <optgroup label="基礎英語">
            <option value="basic_L1">基礎英語 Lv.1（CEFR A1–A2）</option>
            <option value="basic_L2">基礎英語 Lv.2（CEFR B1）</option>
          </optgroup>
          <optgroup label="大学院・過去問">
            <option value="waseda2024">早稲田 一般英語 2024</option>
            <option value="waseda2025">早稲田 一般英語 2025</option>
          </optgroup>
          <optgroup label="専門分野">
            <option value="psycho">精神分析 × 文学（研究用語）</option>
          </optgroup>
          <option value="all">すべての単語をまとめて</option>
        </select>
      </div>

      <div class="button-group">
        <button class="primary" id="start-quiz">クイズを始める</button>
        <button id="open-stats" class="secondary">成績一覧を見る</button>
      </div>

      <details class="help-details">
        <summary>アプリの使い方</summary>
        <div class="small">
          ・英語→日本語＋カタカナ読みの一問一答です。<br />
          ・正解記録はブラウザに保存され、データは消えません。
        </div>
      </details>
    </div>

    <details class="card info-details">
      <summary><strong style="font-size: 13px;">品詞（POS）の略称ガイド</strong></summary>
      <ul class="pos-badge-list">
        <li><b>V</b> 動詞</li>
        <li><b>N</b> 名詞</li>
        <li><b>adj</b> 形容詞</li>
        <li><b>adv</b> 副詞</li>
        <li><b>prep</b> 前置詞</li>
        <li><b>conj</b> 接続詞</li>
      </ul>
      <div class="small">
        ※ S/V/O/C（文型）とは別物です。
      </div>
    </details>

    <details class="card info-details">
      <summary><strong style="font-size: 13px;">アップデート予定</strong></summary>
      <ul class="plan-list">
        <li>精神分析：用語増量（200語規模へ）</li>
        <li>早稲田 一般英語：過去問重要語</li>
        <li>文学作品別の単語セット</li>
      </ul>
    </details>
  </div>

  <script>
    const categorySelect = document.getElementById("category");
    const startQuizBtn = document.getElementById("start-quiz");
    const openStatsBtn = document.getElementById("open-stats");

    function goTo(view) {
      const cat = categorySelect.value;
      const url = `quiz.html?view=${view}&cat=${encodeURIComponent(cat)}`;
      location.href = url;
    }

    startQuizBtn.addEventListener("click", () => goTo("quiz"));
    openStatsBtn.addEventListener("click", () => goTo("stats"));
    
    // 全単語データを統合して検索対象にする
    let allWords = [];

    // ページ読み込み時にデータをロード（パスは環境に合わせて調整してください）
    async function loadSearchData() {
      const categories = ['basic_L1']; // 検索対象にしたいjsonファイル名
      for (const cat of categories) {
        try {
          const res = await fetch(`data/${cat}.json`);
          const data = await res.json();
          allWords = allWords.concat(data.words);
        } catch (e) { console.error(e); }
      }
    }

    const searchInput = document.getElementById('word-search');
    const resultsDiv = document.getElementById('search-results');

    searchInput.addEventListener('input', (e) => {
      const val = e.target.value.toLowerCase();
      if (!val) {
        resultsDiv.style.display = 'none';
        return;
      }

      const matches = allWords.filter(w => 
        w.en.toLowerCase().includes(val) || 
        w.ja.includes(val)
      ).slice(0, 10); // 上位10件だけ表示

      if (matches.length > 0) {
        resultsDiv.innerHTML = matches.map(w => `
          <div class="search-item" onclick="alert('${w.en}: ${w.ja}')">
            <span class="word">${w.en}</span>
            <span class="meaning">${w.ja}</span>
          </div>
        `).join('');
        resultsDiv.style.display = 'block';
      } else {
        resultsDiv.style.display = 'none';
      }
    });

    // 外側をクリックしたら閉じる
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.search-box-container')) {
        resultsDiv.style.display = 'none';
      }
    });

      loadSearchData();
  </script>
</body>
</html>